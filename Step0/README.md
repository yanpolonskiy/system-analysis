# system-analysis

ШСП

# Make cats free again (MCF)

## Словарь

* `happy cat box` - компания заказчик системы
* `make cats free` - `MCF`, дочерняя компания happy cat box, целью которой станет уменьшение посторонней
  работы `котов-тестировщиков`
* `коты-тестировщики` - коты, которые занимаются тестированием "устройств для игры"; сотрудники `happy cat box` и
  клиенты системы `MCF`
* `коты-клиенты` - `клиенты`, см. `коты-тестировщики`
* `воркеры` - коты, которые выполняют поручения `котов-тестировщиков`, топ-3% талантов среди всех котов планеты
* `матчинг` - процесс подбора `воркеров` для поручений `клиентов`
* `кандидат` - кот, который хочет работать воркером в `MCF`
* `сборщик` - сотрудник отдела расходников
* `печеньковый подрядчик` - компания, доставляющая fur-tune-печенье для каждого заказа клиента

## Стейкхолдеры
* Клиенты коты-тестировщики
* Менеджеры
* Клиенты-воркеры
* Клиенты-кандидаты
* Сборщики
* Контроль качества?
* Бухгалтерия?

## Компоненты системы

### A. Личный кабинет клиента

* [US.A-01] Клиент может авторизоваться через внутреннюю систему MCF.
* [US.A-02] Клиент видит данные о себе подтянутые из системы.
* [US.A-03] Клиент видит дашборд со списком всех заказанных им услуг.
* [US.A-04] Клиент может запросить новую услугу нажав кнопку «запросить помощь» и заполнив форму с описанием, типом
  услуги и желаемой датой-временем выполнения.
* [US.A-05] Клиент видит примерную стоимость услуги, когда заполняет форму запроса помощи.
* [US.A-06] Клиент может поменять статус задачи.
* [US.A-07] Клиент видит задачи, которые не были выполнены воркером (отменены).
* [US.A-08] Клиент может создать новый заказ на любую отмененную задачу с возможностью выбора новой даты.
* [US.A-09] Клиент должен указать способ оплаты задач.
* [US.A-10] Клиент видит сумму, которую ему нужно будет оплатить в конце каждой недели.
* [US.A-11] Клиент видит исторические данные по списанию денег.
* [US.A-12] Клиент видит список инвойсов с итоговой суммой, статусами оплаты и списком задач, вошедших в каждый инвойс.
* [US.A-13] Клиент видит значение величины своей текущей скидки.

### B. Приложение для воркеров

* [US.B-01] Воркер видит список активных для него задач, а также список завершённых и отменённых услуг.
* [US.B-01] Воркер видит всю информацию по заказу - что и где получить.
* [US.B-01] Воркер может приступить к заказу (отправить фотографию и нажать кнопку приступил).
* [US.B-02] Воркер видит сколько он заработал и сколько штрафов получил в текущем месяце.
* [US.B-02] Воркер видит список инвойсов с итоговой суммой, статусами оплаты и списком задач, вошедших в каждый инвойс.
* [US.B-11] Клиент видит исторические данные по списанию денег.

### C. Личный кабинет менеджера

#### CA. Управление услугами

* [US.CA-01] Менеджер управляет списком типов услуг, которые `воркеры` оказывают `клиентам`.
* [US.CA-02] Менеджер может задать константное значение/простое математическое выражние для стоимости оказания услуги.

#### CB. Управление наймом

* [US.CB-01] Менеджер управляет набором тестов для проверки `кандидатов` в `воркеры`.
* [US.CB-02] Менеджер управляет списком вакансий `воркеров` и набором тестов для каждой вакансии.
* [US.CB-03] Менеджер видит список заявок от `кандидатов`.
* [US.CB-04] Менеджер может создавать/удалять/редактировать наборы тестов.
* [US.CB-05] Менеджер может добавлять набор тестов к `кандидату`.
* [US.CB-06] Менеджер может управ набором тестов для каждого отдельного `кандидата`.
* [US.CB-07] Менеджер может одобрить `кандидата` по итогам прохождения тестирования.
* [US.CB-08] Менеджер может отбраковать `кандидата` по итогам прохождения тестирования.
* [US.CB-09] Менеджер заполняет характеристику на `кандидата`  при одобрении заявки.
* [US.CB-10] Менеджер изменить характеристики `кандидата` (имя, возраст, порода, цвет шерсти, фото)
* [US.CB-10] Менеджер может посмотреть характеристики `кандидата`.

#### CC. Управление воркерами

* [US.CC-01] Менеджер видит список `воркеров`.
* [US.CC-02] Менеджер может зачислить любое количество денег для выбранного `воркера` на своё усмотрение.

#### CD. Контроль качества работы воркеров

* [US.CD-01] Менеджер видит список выполненных заказов.
* [US.CD-02] Менеджер может выбрать любой выполненный заказ и проверить качество выполненной работы.
* [US.CD-03] Менеджер видит список отмененных и проваленных заказов изучения качества.
* [US.CD-04] Менеджер заносит результаты проверки качества в отдельную форму.

#### CF. Мотивация менеджеров

* [US.CE-01] Менеджер может сделать ставку на любой заказ до момента выполнения или отмены. Для этого он заполняет сумму
  и условие "выполнен" / "провален".
* [US.CE-02] При выполнении или провале, система определяет какие ставки выиграли и делит сумму всех ставок на
  количество выигравших.
* [US.CE-03] При выполнении или провале, система определяет какие ставки выиграли и делит сумму всех ставок на
  количество выигравших.
* [US.CE-04] Менеджер видит, сколько он выиграл или сколько должен скинуть выигравшим.

### D. Сбор расходников

* [US.D-01] Сборщик видит список заказов, для которых нужно собрать расходники.
* [US.D-02] Сборщик видит в заказе данные из задачи клиента: тип, описание и желаемую дату-время исполнения.
* [US.D-03] Сборщик может отметить заказ как выданный.
* [US.D-04] Печеньковый подрядчик получает информацию о клиенте для изготовления и доставки печенья.

### E. Сайт для устройства в штат MCF

* [US.E-01] Кандидат видит список открытых вакансий.
* [US.E-02] Кандидат может оставить заявку на сайте, указав имя, возраст, порода, цвет шерсти, фото

### F. Билинг и учет

#### FA. Списания

* [US.FA-01] Система регистрирует будущее списание со счета клиента после успешного матчинга клиента и воркера.
* [US.FA-02] Система расчитывает размер персональной скидки клиенту по сумме всех предыдущих оплат.
* [US.FA-03] Система расчитывает стоимость по секретной формуле, которую пока никто не знает, поэтому для первой версии
  хватит задать константное значение в 100 условных кото-единиц за любую услугу. Расчет происходит с учетом персональной
  скидки.
* [US.FA-04] Каждое воскресенье система создает для клиента инвойс на оплату из списаний за неделю.
* [US.FA-05] Система списывает сумму по инвойсу через указанный клиентом в личном кабинете способ.
* [US.FA-06] При успешном списании средств, система помечает инвойс и списания как оплаченные.

#### FB. Начисления

* [US.FB-01] Система регистрирует будущее начисление воркеру после успешного выполнения заказа.
* [US.FB-02] Система рассчитывает размер начисления воркеру как 60% от стоимости услуги.
* [US.FB-03] Система начисляет воркеру штраф в размере 40 условных кото-единиц при провале задачи.
* [US.FB-04] Каждый последний день месяца система создает для воркера инвойс для начисления вознаграждения за оказанные
  услуги.
* [US.FB-05] Система рассчитывает сумму итогового начисления воркеру равную общим выплатам минус все штрафы за текущий
  месяц.
* [US.FB-06] Система зачисляет средства воркеру через золотую шляпу (уникальный сервис для перевода денег, никак не
  связанный с «золотой короной»).
* [US.FB-07] При успешном зачислении, система помечает инвойс и начисления как выполненные.


#### FС. Система заказов

* [US.FС-01] Система может создавать/изменять заказы
* [US.FС-02] У каждого заказа есть статус, описание, исполнитель, клиент
* [US.FС-03] Клиент и исполнитель связаные с внешней сервисом на уровне БД (форейн ки (что-то на бекендерском))

### G. Система найма

* [US.G-01] Система регистрирует заявки кандидатов в воркеры
* [US.G-02] Система хранит информацию о кандидате: имя, возраст, порода, цвет шерсти, фото, сильные слабые стороны
* [US.G-03] В системе можно изменять информацию о кандидате: имя, возраст, порода, цвет шерсти, фото, сильные
  слабые стороны; в виде строки похожей на https://en.wikipedia.org/wiki/RNA 
* [US.G-04] Система может декодировать информацию из строки в характеристики
* [US.G-05] Система хранит информацию забракован ли кандидат или нет


### H. Система уведомлений

* [US.H-01] Система может создать сущность уведомление по событию из внешней системы
* [US.H-02] Система может отправить уведомление по событию. Необходимые данные - адресат, текст, канал
* [US.H-03] Система спроектирована с возможностью расширения каналов передачи сообщений

### I. Система метчинга
* [US.I-01] Система по алгоритму может сопоставить клиента и воркера


### J. Админка
* [US.I-01] TBD

## Нагрузка

Базовая:

* 10 заказов в день
* 100 клиентов
* 20 вркеров
* 15 менеджеров
* 1000 заявок в день от котов, желающих стать воркерами

Заложить примерный план работ на рост нагрузки, до highload
Заложиться на ddos - атаки от конкурентов
Написаны нагрузочные тесты

## Технические требования

В каждом сервисе линтеры (в зависимости от выбранного языка) проходят без ошибок и предупреждений.
В пакет линтеров включены проверки безопасности.
Каждый сервис покрыт юнит-тестами не ниже 80%. (потеряем ТТМ в начале, выиграем потом)

## Схема взаимодействия компонентов

![](./attachments/step-0-components.jpg)

### Обоснование

Использовал микросервисный подход, потому что бизнес-область можно поделить на домены, которые в будущем, при росте 
системы, можно развивать независимо.

Нагрузка от заказчика маленькая, но мы балансировщик воткнули на всякий от конкурентов и для будущего 
горизонтального роста

Общение пойдет через систему обмену сообщений, какой это будет брокер/шина или что - сейчас неважно, это не влияет на 
архитектурные решения

Все уведомления должны ходить через сервис нотификаций, который можно расширять горизонтально (хоть в WoW в 
сообщения отправляйте, главное дайте адаптер)

Какая будет бд сейчас тоже не важно, все это решим уже в конце описав все методы и контракты

Описав доменные области и контракты, каждый микросервис можно писать независимо и в параллеь

## Вопросы и спорные места.

* Автоматическое попадание в систему понял, как авторизацию через внутренние системы, уточнить у менеджеров
* У сборщиков расходников есть кнопка, чтобы отметить расходники выданными, но нет кнопки, чтобы отметить заказ
  собранным.
* Сотрудники отдела изучения качества работы и "менеджеры" - это одни и те же люди?
* Каким способом сообщается печеньковозу о необходимости доставки печеньки?
* Какие данные необходимы для регистрации в воркеры?
